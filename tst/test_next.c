/**
 * @file
 *
 * Test suite of LibISAAC
 *
 * @copyright Copyright © 2020, Matjaž Guštin <dev@matjaz.it>
 * <https://matjaz.it>. All rights reserved.
 * @license BSD 3-clause license.
 */

#include "test.h"

#define EXPECTED_STREAM_ELEMENTS 512

/*
 * This is the stream of uint32 values obtained by calling isaac_next()
 * repeatedly after the isaac_ctx_t has been initialised with a zero seed.
 *
 * The value is obtained from the ISAAC's author website
 * https://www.burtleburtle.net/bob/rand/randvect.txt
 * and could be obtained from the reference implementation by
 * compiling any version (e.g. rand.c or randport.c) with the -DNEVER flag
 * and running it, as it sets a zero seed.
 */
const static uint32_t expected_zero_seed_stream[EXPECTED_STREAM_ELEMENTS] = {
        0xF650E4C8UL, 0xE448E96DUL, 0x98DB2FB4UL, 0xF5FAD54FUL, 0x433F1AFBUL,
        0xEDEC154AUL, 0xD8370487UL, 0x46CA4F9AUL, 0x5DE3743EUL, 0x88381097UL,
        0xF1D444EBUL, 0x823CEDB6UL, 0x6A83E1E0UL, 0x4A5F6355UL, 0xC7442433UL,
        0x25890E2EUL, 0x7452E319UL, 0x57161DF6UL, 0x38A824F3UL, 0x002ED713UL,
        0x29F55449UL, 0x51C08D83UL, 0xD78CB99EUL, 0xA0CC74F3UL, 0x8F651659UL,
        0xCBC8B7C2UL, 0xF5F71C69UL, 0x12AD6419UL, 0xE5792E1BUL, 0x860536B8UL,
        0x09B3CE98UL, 0xD45D6D81UL, 0xF3B26129UL, 0x17E38F85UL, 0x29CF72CEUL,
        0x349947B0UL, 0xC998F9FFUL, 0xB5E13DAEUL, 0x32AE2A2BUL, 0xF7CF814CUL,
        0x8EBFA303UL, 0xCF22E064UL, 0x0B923200UL, 0xECA4D58AUL, 0xEF53CEC4UL,
        0xD0F7B37DUL, 0x9C411A2AUL, 0xFFDF8A80UL, 0xB40E27BCUL, 0xB4D2F976UL,
        0x44B89B08UL, 0xF37C71D5UL, 0x1A70E7E9UL, 0x0BDB9C30UL, 0x60DC5207UL,
        0xB3C3F24BUL, 0xD7386806UL, 0x229749B5UL, 0x4E232CD0UL, 0x91DABC65UL,
        0xA70E1101UL, 0x8B87437EUL, 0x5781414FUL, 0xCDBC62E2UL, 0x8107C9FFUL,
        0x69D2E4AEUL, 0x3B18E752UL, 0xB143B688UL, 0x6F4E0772UL, 0x95138769UL,
        0x943C3C74UL, 0xAFC17A97UL, 0x0FD43963UL, 0x6A529B0BUL, 0xD8C58A6AUL,
        0xA8BCC22DUL, 0x2DB35DFEUL, 0xA7A2F402UL, 0x6CB167DBUL, 0x538E1F4EUL,
        0x7275E277UL, 0x1D3B8E97UL, 0xECC5DC91UL, 0x15E3A5B9UL, 0x03696614UL,
        0x30AB93ECUL, 0xAC9FE69DUL, 0x7BC76811UL, 0x60EDA8DAUL, 0x28833522UL,
        0xD5295EBCUL, 0x5ADB60E7UL, 0xF7E1CDD0UL, 0x97166D14UL, 0xB67EC13AUL,
        0x210F3925UL, 0x64AF0FEFUL, 0x0D028684UL, 0x3AEA3DECUL, 0xB058BAFBUL,
        0xB8B0CCFCUL, 0xF2B5CC05UL, 0xE3A662D9UL, 0x814BC24CUL, 0x2364A1AAUL,
        0x37C0ED05UL, 0x2B36505CUL, 0x451E7EC8UL, 0x5D2A542FUL, 0xE43D0FBBUL,
        0x91C8D925UL, 0x60D4D5F8UL, 0x12A0594BUL, 0x9E8A51DAUL, 0xCD49EBDBUL,
        0x1B0DCDC1UL, 0xCD57C7F7UL, 0xE6344451UL, 0x7DED386FUL, 0x2F36FA86UL,
        0xA6D12101UL, 0x33BC405DUL, 0xB388D96CUL, 0xDB6DBE96UL, 0xFE29661CUL,
        0x13EDC0CBUL, 0xCB0EEE4AUL, 0x70CC94AEUL, 0xDE11ED34UL, 0x0606CF9FUL,
        0x3A6CE389UL, 0x23D74F4EUL, 0xA37F63FFUL, 0x917BDEC2UL, 0xD73F72D4UL,
        0x0E7E0E67UL, 0x3D77D9A2UL, 0x13ADD922UL, 0x8891B3DBUL, 0x01A9BD70UL,
        0x56A001E3UL, 0xD51F093DUL, 0xCC033CE3UL, 0x5AD0D3B0UL, 0x34105A8CUL,
        0x6A123F57UL, 0xBD2E5024UL, 0x7364944BUL, 0xE89B1A3BUL, 0x21835C4DUL,
        0x9F39E2D9UL, 0xD405DED8UL, 0x294D37E5UL, 0xBCCAAEEDUL, 0x35A124B5UL,
        0x6708A2BCUL, 0xB00960BAUL, 0x2A98121AUL, 0x4D8FAE82UL, 0x0BB3263FUL,
        0x12595A19UL, 0x6A107589UL, 0x0809E494UL, 0x21C171ECUL, 0x884D6825UL,
        0x14C8009BUL, 0xB0B84E7BUL, 0x03FB88F4UL, 0x28E7CB78UL, 0x9388B13BUL,
        0xDD2DC1D5UL, 0x848F520AUL, 0x07C28CD1UL, 0x68A39358UL, 0x72C9137DUL,
        0x127DD430UL, 0xC613F157UL, 0x8C2F0D55UL, 0xF7D3F39FUL, 0x309BFB78UL,
        0x8406B137UL, 0x46C0A6F5UL, 0x3718D597UL, 0x08607F04UL, 0x76904B6DUL,
        0x04DB4E13UL, 0xCD7411A7UL, 0xB510CE0EUL, 0xBFC7F7CCUL, 0xB83F957AUL,
        0xFDFEF62DUL, 0xC35E4580UL, 0x3FF1E524UL, 0x4112D96CUL, 0x02C9B944UL,
        0xD5990DFBUL, 0xE7E26581UL, 0x0D9C7E7EUL, 0x826DFA89UL, 0x66F1E0ABUL,
        0x30BCC764UL, 0xEADEBEACUL, 0xED35E5EEUL, 0x0C571A7DUL, 0xE4F3A26AUL,
        0xF7F58F7BUL, 0xADF6BC23UL, 0x5D023E65UL, 0x1ED3FF4EUL, 0xEC46B0B6UL,
        0xD2A93B51UL, 0xE75B41C9UL, 0x7E315AEBUL, 0x61119A5AUL, 0x53245B79UL,
        0x33F6D7B1UL, 0xCAE8DEBAUL, 0x50FC8194UL, 0xAFA92A6DUL, 0xC87C8006UL,
        0x4188BFCDUL, 0x8BACE62EUL, 0x78FFA568UL, 0x5597EC0FUL, 0xB4415F7DUL,
        0x08294766UL, 0xAD567643UL, 0x09C36F90UL, 0x3DDE9F39UL, 0x4A0A283CUL,
        0x18080C8EUL, 0x080C79ECUL, 0x79AE4C10UL, 0xCB9E1563UL, 0x7CDD662FUL,
        0x62D31911UL, 0xA4CA0CF1UL, 0x5CF824CDUL, 0x3B708F99UL, 0x1E16614CUL,
        0xB6B9D766UL, 0x5DE87ABBUL, 0x7229EA81UL, 0xD5B2D750UL, 0x56E6CD21UL,
        0xFE1E42D5UL, 0x96DA2655UL, 0xC2B9AA36UL, 0xB8F6FD4AUL, 0x6A158D10UL,
        0x01913FD3UL, 0xAF7D1FB8UL, 0x0B5E435FUL, 0x90C10757UL, 0x6554ABDAUL,
        0x7A68710FUL, 0x82AC484FUL, 0xD7E1C7BEUL, 0x95C85EAAUL, 0x94A302F4UL,
        0x4D3CFBDAUL, 0x786B2908UL, 0x1010B275UL, 0x82D53D12UL, 0x21E2A51CUL,
        0x3D1E9150UL, 0xB059261DUL, 0xD0638E1AUL, 0x31860F05UL, 0x81F2864DUL,
        0xFF4CFC35UL, 0x0451516DUL, 0xBD086F26UL, 0xBC5654C1UL, 0x65DFA427UL,
        0xA82427F5UL, 0x582E3014UL, 0xB8D2486DUL, 0xC79A1749UL, 0x9A1D7745UL,
        0x8766BB54UL, 0x1E04A7F7UL, 0x3D3DFF8AUL, 0xD5EC6BF4UL, 0xDBEF7D9FUL,
        0x36EC0EA3UL, 0x1FEB2E4FUL, 0x15CFCC5CUL, 0xD8C423FBUL, 0xD0EF3CC9UL,
        0xEB244925UL, 0xBA5590C8UL, 0xA5F48AC4UL, 0x33C5321CUL, 0x613B67B2UL,
        0x479C3A22UL, 0xE21339CCUL, 0x10D210AAUL, 0x931DD7E2UL, 0xEF05EE06UL,
        0xB82F2703UL, 0xA385CB2CUL, 0x5D67133CUL, 0x877EB7B4UL, 0x1E3437F7UL,
        0x5AFB43AEUL, 0x53C078F3UL, 0x94D90481UL, 0x1D964589UL, 0x08063A85UL,
        0xE1322228UL, 0x1956B1E5UL, 0x31860F13UL, 0x2E7B022FUL, 0x21182CA3UL,
        0x96F703ACUL, 0x46819E2EUL, 0x0D28FE52UL, 0x3724D4DCUL, 0xA0EABE6BUL,
        0xC66699FDUL, 0xC6112FDDUL, 0x19C1E69CUL, 0x04D3658AUL, 0x4B55DD99UL,
        0x31907D62UL, 0xF854B522UL, 0x4D678F26UL, 0x22AE0582UL, 0xEAFED133UL,
        0xE4A51D21UL, 0x84BD6DD6UL, 0xC1A51375UL, 0x3F28EE63UL, 0xFB737B1AUL,
        0x70A1660EUL, 0x8A8DFAA3UL, 0x1BE79937UL, 0xF7476978UL, 0x513C1764UL,
        0x531AC6BFUL, 0x12C06908UL, 0x001CDB95UL, 0x1A4B6A53UL, 0xD067FCE5UL,
        0x12B2CFB6UL, 0x9DDB477FUL, 0x740E0066UL, 0x39DDF25AUL, 0xCC8BFA2DUL,
        0xF1B20EAFUL, 0x64F2632CUL, 0x9783CDEEUL, 0x63BFD4D8UL, 0x0084CFE5UL,
        0x75F4E9E2UL, 0x19B48FD0UL, 0x6C48DDD8UL, 0x7A36AF93UL, 0x71865C4CUL,
        0x9CE0199DUL, 0x867027D7UL, 0x2CB7B77FUL, 0x84EF01DAUL, 0x72F5972FUL,
        0x040F7074UL, 0xDF9AFA29UL, 0xC921F94EUL, 0x75C08A36UL, 0x18C1EF9AUL,
        0xD649A428UL, 0xC5B71937UL, 0x8A30738AUL, 0xD97CD348UL, 0x858129A6UL,
        0x239E3B0AUL, 0xBBB8ABC4UL, 0x80FAC4C2UL, 0xECFCF20BUL, 0xD9D711F9UL,
        0xE2A4EF71UL, 0xB5FE87C0UL, 0xBE8B06B2UL, 0xAAFEF5A7UL, 0x9C15DB3BUL,
        0x0AEB8165UL, 0x4389A84AUL, 0x253B1D7AUL, 0x19047C79UL, 0x7CDC78A2UL,
        0xD20ADF03UL, 0x56F55A71UL, 0x3E730FA8UL, 0xFD8650D8UL, 0x959E234EUL,
        0xB7546681UL, 0xDAD1B22AUL, 0x142A6E85UL, 0x8EF4BCE6UL, 0x68235B9DUL,
        0x85A13F85UL, 0x74096AE7UL, 0xA949BEA2UL, 0x29322D0DUL, 0xD5683858UL,
        0x82846526UL, 0x403DAE08UL, 0x6DD1943AUL, 0xE1279BFFUL, 0x9E7E4F04UL,
        0x1C3A4524UL, 0x484525E4UL, 0x81D4CC5FUL, 0xE24124C0UL, 0x037464C0UL,
        0xBF1BD691UL, 0x26CEB003UL, 0x275EAD3AUL, 0xC5BDE908UL, 0x26414FF3UL,
        0xA30519ADUL, 0xD7B43ABEUL, 0x2CE5D3D5UL, 0x88412761UL, 0x97CA2070UL,
        0xE5FBB9C7UL, 0x276DF0B4UL, 0x308F751FUL, 0x37A97DF6UL, 0xC9CD808CUL,
        0xFE4CB380UL, 0x3D469303UL, 0xAEE19096UL, 0xC0D5D42AUL, 0x4E823AD3UL,
        0xF5F9CC3BUL, 0x4286619CUL, 0x9CA45E1CUL, 0x66C97340UL, 0x891AEC49UL,
        0x45BAE606UL, 0xC798F047UL, 0x52649D6CUL, 0xCE86FDFCUL, 0x80C6E402UL,
        0xD6EC2F2BUL, 0x27C82282UL, 0x1FE26CE0UL, 0x92F57EA7UL, 0xDE462F4DUL,
        0x07497CAEUL, 0x5A48755CUL, 0x721502DDUL, 0x6CBE7935UL, 0x836D8003UL,
        0x9EAD7F70UL, 0x9AB3A42FUL, 0x4C8652D6UL, 0x32E39273UL, 0xE8FA3860UL,
        0x1DA4F25AUL, 0x0CD6EF81UL, 0x02503F7DUL, 0x8854A0A1UL, 0x9A30C4E8UL,
        0x88157153UL, 0x05EFE294UL, 0x57C4C925UL, 0x2887D96FUL, 0xC1A71E3CUL,
        0xE9F84163UL, 0x2D0985DEUL, 0xD21E796CUL, 0x6FB5CE56UL, 0x02614ABFUL,
        0xC3C7BE2CUL, 0xB54FED6FUL, 0xA617A083UL, 0xC3142D8FUL, 0x6079E4CEUL,
        0xCEFFC147UL, 0x1D0CB81BUL, 0xDC153E5FUL, 0xE36EF5BBUL, 0xD531161AUL,
        0x165B1015UL, 0x7AA114EDUL, 0x3F7579B3UL, 0xF7F395F1UL, 0xBC6172C7UL,
        0xA86F875EUL, 0x0E6C51B3UL, 0xCDFEC2AFUL, 0x73C0E762UL, 0x824C2009UL,
        0xC5A87748UL, 0x94D40125UL, 0x8ABA3FFBUL, 0xD32BE060UL, 0x8C17EFF0UL,
        0x21E2547EUL, 0x07CFFAD9UL, 0x05340E15UL, 0xF3310C92UL, 0x9D8D1908UL,
        0x86BA527FUL, 0xF943F672UL, 0xEF73FBF0UL, 0x46D95CA5UL, 0xC54CD95BUL,
        0x9D855E89UL, 0x4BB5AF29UL,
};

static void test_next_once(void)
{
    isaac_ctx_t ctx;
    memset(&ctx, 0, sizeof(ctx)); // Zero seed
    isaac_init(&ctx, true);

    const uint32_t next = isaac_next(&ctx);

    atto_eq(next, expected_zero_seed_stream[0]);
}

static void test_next_all(void)
{
    uint32_t result;
    isaac_ctx_t ctx;
    memset(&ctx, 0, sizeof(ctx));
    isaac_init(&ctx, true);
    printf("i = ");
    for (uint_fast32_t i = 0; i < EXPECTED_STREAM_ELEMENTS; i++)
    {
        result = isaac_next(&ctx);
        printf("\r%3"PRIu32" | ", i);
        atto_eq(result, expected_zero_seed_stream[i]);
    }
    puts("");
}

void test_isaac_next(void)
{
    test_next_once();
    test_next_against_reference_vector();
}
